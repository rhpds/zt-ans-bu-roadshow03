:notoc:
:toc:
:toc-placement: auto

# üõ°Ô∏è Vulnerability Management with Red Hat Insights and Ansible

## üéØ Scenario 03: Operational Efficiency (Continued)

### Introduction

Moving beyond technical automation, you'll now explore how **Ansible Automation Platform** can orchestrate between systems and tools, acting as organizational "glue" that connects different processes and teams. This advanced scenario demonstrates how to integrate vulnerability and compliance management at scale using **Red Hat Insights**.

Vulnerability and compliance management can be tedious, especially at enterprise scale. However, by integrating **Ansible Automation Platform** with **Red Hat Insights**, you can automate these critical security processes while providing real organizational value through reduced mean time to resolution and proactive threat mitigation.

---

## üîê Lab Environment Setup

### Access Credentials

| **System** | **Username** | **Password** |
|------------|--------------|--------------|
| **Ansible Automation Platform** | admin | ansible123! |
| **ServiceNow** | aap-roadshow | Ans1ble123! |

> ‚ö†Ô∏è **IMPORTANT:** A Red Hat account is required to access Insights. You can use your existing Red Hat account with active subscriptions, or the Red Hat Developer Account created during the lab prerequisites.

---

## üß™ Lab Exercises

### Exercise 1: Red Hat Insights Integration and Remediation

#### ****Step 1: Configure Insights Credentials****

1. Navigate to **Automation Execution** ‚Üí **Infrastructure** ‚Üí **Credentials**
2. Locate the pre-configured **Insights** credential
3. Update the credential with your Red Hat account or Developer account details

![Insights Credentials Setup](/insights-creds.png)

#### ****Step 2: Synchronize Insights Project****

1. Navigate to **Automation Execution** ‚Üí **Projects**
2. Locate the **Insights** project
3. Click **Sync** to synchronize with Red Hat Insights

> üìù **NOTE:** This will clear any failed status and establish the connection to Red Hat Insights services.

![Insights Project Sync](/insights-sync.png)

#### ****Step 3: Register System with Insights****

Your RHEL team has provided a template to configure subscription and register the Insights client:

1. Navigate to **Automation Execution** ‚Üí **Templates**
2. Launch the **Insights for RHEL** template
3. When prompted, provide your Red Hat Subscription/Developer account details

![Insights Login Interface](/insight-login.png)

This template will:
- ‚úÖ Register the system with Red Hat subscription services
- ‚úÖ Install and configure the Insights client
- ‚úÖ Perform the initial system scan
- ‚úÖ Upload system data to **console.redhat.com**

#### ****Step 4: Access Red Hat Insights Console****

1. Once the job completes, navigate to the **console.redhat.com** tab
2. Login with your Red Hat account
3. Select the **Insights for RHEL** panel

![Insights for RHEL Dashboard](/insights4rhel.png)

> üí° **TIP:** Red Hat Insights provides comprehensive vulnerability and compliance management, along with many other beneficial services for enterprise infrastructure.

#### ****Step 5: Review Security Advisories****

1. Navigate to **Content** ‚Üí **Advisories**
2. Review the list of CVEs identified for your registered node

![Security Advisories List](/advisories.png)

> üìù **NOTE:** Each advisory represents a potential security vulnerability that requires attention and possible remediation.

#### ****Step 6: Create Remediation Playbook****

1. Select a CVE advisory (e.g., **RHSA-2024:10274**)
2. Click **Remediate**

![Advisory RHSA-2024-10274](/rhsa-2024-10274.png)

**Remediation Configuration:**

1. Name the remediation playbook: `cve-rhsa-2024-10274`
2. Click **Next**
3. Ensure your **node01** is selected in the system review

![Insights System Review](/review.png)

4. Submit the **Remediation Review**

#### ****Step 7: Deploy Remediation via Ansible****

1. Navigate back to the **aap** tab
2. Go to **Automation Execution** ‚Üí **Projects**
3. Synchronize your **Insights** project to pull the new remediation playbook

**Create Remediation Template:**

1. Navigate to **Automation Execution** ‚Üí **Templates**
2. Create a new template with the following details:

| **Field** | **Value** |
|-----------|-----------|
| **Name** | CVE-2024-1074 |
| **Description** | Remediation of CVE-2024-1074 |
| **Organization** | Default |
| **Project** | Insights |
| **Inventory** | Video Platform Inventory |
| **Playbook** | cve-rhsa-2024-10274-****** |
| **Execution Environment** | RHEL EE |
| **Credentials** | Application Nodes |

> üìù **NOTE:** Use the generated playbook name for the Playbook field.

3. Save and launch the template

#### ****Step 8: Verify Remediation Completion****

After the job completes successfully and the node reboots:

1. Navigate to the **console.redhat.com** tab
2. Select **Automation Toolkit** ‚Üí **Remediations**
3. Verify your remediation shows as completed

---

### Exercise 2: API-Driven Security Intelligence

#### Understanding Insights API Integration

**Red Hat Insights** provides an extensive API that enables you to gather data, build remediation playbooks, and create self-healing infrastructure using **Event-Driven Ansible** source plugins. You'll use this API to gather comprehensive security data for your security teams.

#### ****Step 1: Select Target Advisory****

1. From the **console.redhat.com** tab, navigate to **Content** ‚Üí **Advisories**
2. Choose an Advisory ID (e.g., **RHSA-2024:9474**)

> üí° **TIP:** Make note of the specific advisory ID for the next step.

#### ****Step 2: Execute CVE Data Collection****

1. Navigate to **Automation Execution** ‚Üí **Templates**
2. Launch the **CVE Advisory** template
3. When prompted, provide:
   - Your Red Hat subscription/Developer account credentials
   - The Advisory ID you selected

![CVE Advisory Finder](/cve-finder.png)

> üìù **NOTE:** This automation will connect to Insights via API and gather comprehensive data about the CVE for your security team, then automatically send this information to your ITSM system.

#### ****Step 3: Review Security Intelligence in ServiceNow****

1. Note the incident number from the completed job
2. Navigate to the **servicenow** tab
3. Login with the ServiceNow credentials:

| **Username** | **Password** |
|--------------|--------------|
| aap-roadshow | Ans1ble123! |

**Access Incident Data:**

1. Click **All** ‚Üí **Incidents**
2. Select the ticket titled **Advisory CVE Type**
3. Review the comprehensive CVE data gathered via API from Red Hat Insights

![CVE Ticket Data](/cve-data.png)

> üéØ **SUCCESS:** Your security teams now have complete, actionable data about the CVE, enabling them to make informed decisions about remediation priorities and strategies.

---

## üíª Code Reference

### Insights Registration and Scanning Automation

Here's the automation code for registering systems with Red Hat Insights:

```yaml
tasks:
  - name: Install subscription manager
    ansible.builtin.package:
      name: subscription-manager
      state: present

  - name: Install insights client
    ansible.builtin.package:
      name: insights-client
      state: present

  - name: Register RHEL server with subscription manager
    community.general.redhat_subscription:
      state: present
      username: "{{ rhsm_username }}"
      password: "{{ rhsm_password }}"
      auto_attach: true

  - name: Register insights client
    ansible.builtin.command: insights-client --register

  - name: Perform initial Insights upload
    ansible.builtin.command: >
      /bin/insights-client
    register: __insights_scan
    changed_when: __insights_scan.rc == 0
```

### Key Components Explained

**Subscription Management:**
- Automates Red Hat subscription registration
- Enables automatic entitlement attachment
- Ensures proper licensing for Insights services

**Insights Client Configuration:**
- Installs and configures the Insights client
- Registers systems with Red Hat Insights
- Performs initial system scanning and data upload

**API Integration:**
- Leverages Insights APIs for data collection
- Enables programmatic access to vulnerability data
- Supports integration with external systems (ITSM, monitoring tools)

---

## üèóÔ∏è Architecture Benefits

### Automated Vulnerability Management

**Proactive Security:**
- Automatic vulnerability discovery and assessment
- Continuous system monitoring and analysis
- Integrated remediation playbook generation

**Operational Efficiency:**
- Reduced manual security assessment overhead
- Automated data collection and reporting
- Streamlined remediation workflows

**Business Value:**
- Improved security posture and compliance
- Reduced exposure time for vulnerabilities
- Enhanced audit readiness and documentation

### Integration Ecosystem

**Red Hat Insights Integration:**
- Centralized vulnerability and compliance management
- Enterprise-grade security intelligence
- Automated remediation recommendations

**ITSM Integration:**
- Automatic ticket creation with detailed CVE data
- Seamless workflow integration
- Comprehensive audit trails

**API-Driven Architecture:**
- Scalable data collection and processing
- Flexible integration with existing tools
- Support for custom security workflows

---
